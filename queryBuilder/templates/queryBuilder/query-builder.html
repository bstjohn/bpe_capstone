{% extends "user/base.html" %}

{% block title %}Query Builder{% endblock %}

{% block header %}
{% block header-title %}Query Builder{% endblock %}
{% endblock %}

{% block content %}

<link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
<script>
    $(function() {
    $( ".datepicker" ).datepicker({
      changeMonth: true,
      changeYear: true,
      yearRange: '1900:' + new Date().getFullYear(),
      showOn: 'button'
    }).next('button').text('').button({
            icons: {
                primary: 'icon-calendar'
            },
            text: false
        });
    });

    function showMoreClick() {
        showMoreElement = document.getElementById('conditions-field-set');
        showMoreButton = document.getElementById('show-more');

        if (showMoreElement.style.display == 'none') {
            showMoreElement.style.display = 'block';
            showMoreButton.innerHTML = "Show Less";
        }
        else {
            showMoreElement.style.display = 'none';
            showMoreButton.innerHTML = "Show More";
        }
    }

</script>

<form action="/query-builder/" method="post">
    {% csrf_token %}

    {{ form.non_field_errors }}
    <div class="fieldWrapper">
        {{ form.query_name.errors }}
        <label for="{{ form.query_name.id_for_label }}">Name of Your Query: </label>
        {{ form.query_name }}
    </div>

    <div class="fieldWrapper">
        {{ form.start_date.errors }}
        <label for="{{ form.start_date.id_for_label }}">Start Date: </label>
        {{ form.start_date }}
        {{ form.start_time.errors }}
        <label for="{{ form.start_time.id_for_label }}">Start Time: </label>
        {{ form.start_time }}
    </div>

    <div class="fieldWrapper">
        {{ form.end_date.errors }}
        <label for="{{ form.end_date.id_for_label }}">End Date: </label>
        {{ form.end_date }}
        {{ form.end_time.errors }}
        <label for="{{ form.end_time.id_for_label }}">End Time: </label>
        {{ form.end_time }}
    </div>

    <div class="fieldWrapper">
        {{ form.stations.errors }}
        <label for="{{ form.stations.id_for_label }}">Stations: </label>
        {{ form.stations }}
    </div>

    <div class="fieldWrapper">
        {{ form.condition_type.errors }} {{ form.condition_operator.errors }} {{ form.condition_value.errors }}
        <label for="{{ form.condition_type.id_for_label }}">Condition: </label>
        {{ form.condition_type }} {{ form.condition_operator }} {{ form.condition_value }}
        <br><button id="show-more" onclick="showMoreClick()" type="button">Show More</button>

    </div>

    <fieldset style="border:none; display: none;" id="conditions-field-set">
        {{ formset.non_form_errors }}
        {% for form in formset %}
        <div class="fieldWrapper">
            {{ form.condition_type.errors }} {{ form.condition_operator.errors }} {{ form.condition_value.errors }}
            {{ form.condition_type }} {{ form.condition_operator }} {{ form.condition_value }}
        </div>
        {% endfor %}
    </fieldset>

    <input class="button" type="submit" value="Submit"/>
</form>

<a href="/logout">Logout</a>
{% endblock %}